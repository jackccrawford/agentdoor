---
import Layout from '../layouts/Layout.astro';
---

<Layout title="AgentDoor | Service Directory — 500+ AI-discoverable APIs" description="The largest registry of AI-agent-discoverable services. Browse 500+ APIs with endpoints, pricing, and auth details. Queryable by autonomous agents.">

  <!-- Nav -->
  <nav class="nav">
    <div class="nav-inner">
      <a href="/" class="nav-brand">agent<span>door</span></a>
      <div class="nav-links">
        <a href="/#how" class="nav-link">How it works</a>
        <a href="/directory" class="nav-link" style="font-weight: 600; color: var(--color-accent);">Directory</a>
        <a href="/generate" class="nav-link">Generate</a>
      </div>
      <button class="nav-hamburger" id="navOpen" aria-label="Open menu">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M3 12h18M3 6h18M3 18h18"/></svg>
      </button>
    </div>
  </nav>
  <div class="nav-overlay" id="navOverlay"></div>
  <div class="nav-mobile" id="navMobile">
    <div class="nav-mobile-header">
      <a href="/" class="nav-brand">agent<span>door</span></a>
      <button class="nav-mobile-close" id="navClose" aria-label="Close menu">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M18 6L6 18M6 6l12 12"/></svg>
      </button>
    </div>
    <div class="nav-mobile-links">
      <a href="/#how" class="nav-mobile-link">How it works</a>
      <a href="/directory" class="nav-mobile-link" style="font-weight: 600; color: var(--color-accent);">Directory</a>
      <a href="/generate" class="nav-mobile-link">Generate</a>
    </div>
  </div>

  <div class="dir-page">
    <div class="dir-wrap">

      <!-- Agent API strip -->
      <div class="api-strip">
        <div class="api-strip-inner">
          <div class="api-strip-left">
            <span class="api-strip-label">Agent API</span>
            <code class="api-strip-endpoint">GET /api/directory</code>
          </div>
          <div class="api-strip-right">
            <code class="api-strip-param">?q=search</code>
            <code class="api-strip-param">?protocol=mcp</code>
            <code class="api-strip-param">?pricing=free</code>
            <span class="api-strip-tag">No auth</span>
          </div>
        </div>
      </div>

      <!-- Header -->
      <div class="dir-header">
        <div>
          <h1 class="dir-h1"><span id="totalCount">...</span> services indexed</h1>
          <p class="dir-sub">Every listing is queryable by autonomous agents in real time.</p>
        </div>
        <a href="/generate" class="list-cta">+ List your service</a>
      </div>

      <!-- Toolbar -->
      <div class="toolbar">
        <div class="search-box">
          <svg class="search-ico" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
          <input type="search" id="searchInput" placeholder="Search services..." />
        </div>
        <select id="protocolFilter">
          <option value="">Protocol</option>
          <option value="rest">REST</option>
          <option value="graphql">GraphQL</option>
          <option value="grpc">gRPC</option>
          <option value="websocket">WebSocket</option>
          <option value="mcp">MCP</option>
        </select>
        <select id="pricingFilter">
          <option value="">Pricing</option>
          <option value="free">Free</option>
          <option value="per-request">Per use</option>
          <option value="subscription">Subscription</option>
          <option value="tiered">Tiered</option>
          <option value="contact">Contact</option>
        </select>
      </div>

      <!-- Alpha -->
      <nav class="alpha" id="alphaNav" aria-label="Alphabetical filter"></nav>

      <!-- States -->
      <div id="loading" class="state-loading"><div class="spinner"></div></div>
      <div id="emptyState" class="state-empty">
        <p>No services found.</p>
        <button id="clearFilters" class="clear-btn">Clear filters</button>
      </div>

      <!-- Grid -->
      <div id="grid" class="svc-grid"></div>

      <!-- Show more -->
      <div id="moreWrap" class="more-wrap">
        <button id="moreBtn" class="more-btn">Show more <span id="moreCount"></span></button>
      </div>
      <p id="info" class="info-line"></p>

    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-inner">
      <a href="/" class="nav-brand" style="font-size: 1rem;">agent<span>door</span></a>
      <div class="footer-links">
        <a href="/generate" class="footer-link">Generator</a>
        <a href="/directory" class="footer-link">Directory</a>
        <a href="https://mvara.ai" class="footer-link" target="_blank">Built by mVara</a>
      </div>
    </div>
  </footer>
</Layout>

<style is:global>
  /* ── Page ── */
  .dir-page { padding-top: 64px; background: #f8f8f8; min-height: 100vh; overflow-x: hidden; }
  .dir-wrap { max-width: 1120px; margin: 0 auto; padding: 0 24px; box-sizing: border-box; }

  /* ── API Strip ── */
  .api-strip {
    margin-top: 20px;
    background: #111111;
    border-radius: 10px;
    overflow: hidden;
  }
  .api-strip-inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 18px;
    gap: 12px;
    flex-wrap: wrap;
  }
  .api-strip-left {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .api-strip-label {
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: #F97316;
    background: rgba(249,115,22,0.12);
    padding: 2px 6px;
    border-radius: 3px;
  }
  .api-strip-endpoint {
    font-family: var(--font-mono);
    font-size: 13px;
    color: rgba(255,255,255,0.85);
  }
  .api-strip-right {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .api-strip-param {
    font-family: var(--font-mono);
    font-size: 11px;
    color: rgba(255,255,255,0.3);
  }
  .api-strip-tag {
    font-size: 10px;
    font-weight: 600;
    color: rgba(255,255,255,0.5);
    background: rgba(255,255,255,0.08);
    padding: 2px 7px;
    border-radius: 3px;
    text-transform: uppercase;
    letter-spacing: 0.03em;
  }
  @media (max-width: 640px) { .api-strip-right { display: none; } }

  /* ── Header ── */
  .dir-header {
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    padding: 36px 0 24px;
    gap: 16px;
    flex-wrap: wrap;
  }
  .dir-h1 {
    font-size: 28px;
    font-weight: 700;
    letter-spacing: -0.025em;
    color: var(--color-ink);
    line-height: 1.15;
    font-variant-numeric: tabular-nums;
    margin: 0;
  }
  .dir-sub {
    font-size: 14px;
    color: #a3a3a3;
    margin-top: 4px;
  }
  .list-cta {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 8px 16px;
    font-size: 13px;
    font-weight: 600;
    background: var(--color-accent);
    color: white;
    border-radius: 6px;
    text-decoration: none;
    transition: all 0.15s;
    flex-shrink: 0;
  }
  .list-cta:hover { background: var(--color-accent-dark); transform: translateY(-1px); }

  /* ── Toolbar ── */
  .toolbar {
    display: flex;
    gap: 8px;
    padding-bottom: 16px;
    flex-wrap: wrap;
  }
  .search-box {
    position: relative;
    flex: 1;
    min-width: 160px;
    max-width: 280px;
  }
  .search-ico {
    position: absolute;
    left: 10px;
    top: 50%;
    transform: translateY(-50%);
    color: #a3a3a3;
    pointer-events: none;
  }
  .search-box input, .toolbar select {
    height: 36px;
    font-size: 13px;
    font-family: var(--font-body);
    border: 1px solid #e5e5e5;
    border-radius: 8px;
    background: white;
    color: var(--color-ink);
    transition: border-color 0.15s, box-shadow 0.15s;
    box-shadow: 0 1px 2px rgba(0,0,0,0.04);
  }
  .search-box input {
    width: 100%;
    padding: 0 10px 0 30px;
  }
  .toolbar select {
    padding: 0 24px 0 10px;
    color: #737373;
    cursor: pointer;
    -webkit-appearance: none;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 24 24' fill='none' stroke='%23a3a3a3' stroke-width='2.5'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 8px center;
  }
  .search-box input:focus, .toolbar select:focus {
    outline: none;
    border-color: #a3a3a3;
    box-shadow: 0 0 0 3px rgba(0,0,0,0.04);
  }

  /* ── Alpha nav ── */
  .alpha {
    display: flex;
    flex-wrap: wrap;
    gap: 2px;
    padding-bottom: 16px;
    border-bottom: 1px solid #ebebeb;
    margin-bottom: 24px;
  }

  .alpha-letter {
    width: calc((100% - 26 * 2px) / 27);
    min-width: 28px;
    height: 28px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: 500;
    border: none;
    border-radius: 6px;
    background: transparent;
    color: #a3a3a3;
    cursor: pointer;
    transition: all 0.12s;
    font-family: var(--font-body);
    padding: 0;
    flex-shrink: 1;
    box-sizing: border-box;
  }
  .alpha-letter:hover { background: white; color: #171717; box-shadow: 0 1px 3px rgba(0,0,0,0.06); }
  .alpha-letter.active { background: #171717; color: white; box-shadow: 0 1px 3px rgba(0,0,0,0.12); }
  .alpha-letter.off { opacity: 0.2; pointer-events: none; }

  /* ── States ── */
  .state-loading { text-align: center; padding: 48px 0; }
  .state-loading .spinner { margin: 0 auto; }
  .state-empty { display: none; text-align: center; padding: 48px 0; color: #a3a3a3; font-size: 14px; }
  .clear-btn {
    margin-top: 8px;
    padding: 5px 14px;
    font-size: 12px;
    border: 1px solid #e5e5e5;
    border-radius: 6px;
    background: white;
    color: #737373;
    cursor: pointer;
    font-family: var(--font-body);
  }
  .clear-btn:hover { border-color: #d4d4d4; }

  /* ── Grid ── */
  .svc-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 8px;
  }

  /* ── Card ── */
  .card {
    display: flex;
    gap: 12px;
    padding: 16px;
    background: white;
    border: 1px solid rgba(0,0,0,0.06);
    border-radius: 10px;
    transition: box-shadow 0.15s, transform 0.15s;
    cursor: default;
    min-width: 0;
    overflow: hidden;
  }
  .card:hover {
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    transform: translateY(-1px);
  }

  .card-ico {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: 700;
    color: white;
    flex-shrink: 0;
    letter-spacing: -0.02em;
    text-transform: uppercase;
  }

  .card-body {
    flex: 1;
    min-width: 0;
  }

  .card-top {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .card-name {
    font-size: 14px;
    font-weight: 650;
    color: #111111;
    letter-spacing: -0.01em;
    line-height: 1.3;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .card-badge {
    flex-shrink: 0;
    font-size: 11px;
    font-weight: 500;
    color: #525252;
    background: #f5f5f5;
    padding: 1px 7px;
    border-radius: 999px;
    line-height: 1.55;
    white-space: nowrap;
  }

  .card-desc {
    font-size: 12.5px;
    color: #a3a3a3;
    line-height: 1.45;
    margin-top: 3px;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .card-tags {
    display: flex;
    gap: 4px;
    margin-top: 8px;
  }

  .pill {
    font-size: 10px;
    font-weight: 500;
    padding: 2px 7px;
    border-radius: 4px;
    line-height: 1.5;
  }
  .pill-proto { background: #f0f0f5; color: #5b5b8a; }
  .pill-free { background: #dcfce7; color: #166534; }
  .pill-paid { background: #f5f0e8; color: #8a6b3d; }

  /* ── Show more ── */
  .more-wrap { display: none; text-align: center; padding: 24px 0; }
  .more-btn {
    padding: 8px 28px;
    font-size: 13px;
    font-weight: 500;
    border: 1px solid #e5e5e5;
    border-radius: 8px;
    background: white;
    color: #525252;
    cursor: pointer;
    font-family: var(--font-body);
    transition: all 0.15s;
    box-shadow: 0 1px 2px rgba(0,0,0,0.04);
  }
  .more-btn:hover { border-color: #d4d4d4; color: #171717; box-shadow: 0 2px 6px rgba(0,0,0,0.06); }
  .more-btn span { font-size: 11px; color: #a3a3a3; font-weight: 400; }

  .info-line {
    text-align: center;
    font-size: 11px;
    color: #a3a3a3;
    padding: 4px 0 48px;
  }
</style>

<script>
  const grid = document.getElementById('grid');
  const loading = document.getElementById('loading');
  const emptyState = document.getElementById('emptyState');
  const totalCount = document.getElementById('totalCount');
  const searchInput = document.getElementById('searchInput');
  const protocolFilter = document.getElementById('protocolFilter');
  const pricingFilter = document.getElementById('pricingFilter');
  const alphaNav = document.getElementById('alphaNav');
  const moreWrap = document.getElementById('moreWrap');
  const moreBtn = document.getElementById('moreBtn');
  const moreCount = document.getElementById('moreCount');
  const info = document.getElementById('info');
  const clearBtn = document.getElementById('clearFilters');

  let all = [], filtered = [], shown = 0;
  const PER_PAGE = 60;
  let alphaActive = '';

  // Muted, professional palette for initials
  const PAL = ['#6366F1','#8B5CF6','#3B82F6','#0EA5E9','#14B8A6','#10B981','#F59E0B','#EF4444','#EC4899','#A855F7','#6D28D9','#0891B2','#059669','#D97706','#DC2626'];
  function hc(s) { let h=0; for(let i=0;i<s.length;i++) h=s.charCodeAt(i)+((h<<5)-h); return PAL[Math.abs(h)%PAL.length]; }
  function ini(s) { const w=s.split('-').filter(Boolean); return w.length===1 ? w[0].slice(0,2).toUpperCase() : (w[0][0]+w[1][0]).toUpperCase(); }

  const UP = {aws:'AWS',api:'API',openai:'OpenAI',grpc:'gRPC',mcp:'MCP',cdn:'CDN',ci:'CI',pdf:'PDF',dns:'DNS',sns:'SNS',sdk:'SDK',ai:'AI',ml:'ML',crm:'CRM',cms:'CMS',fhir:'FHIR',ipfs:'IPFS',sso:'SSO',sp:'SP',io:'.io',com:'.com',dev:'.dev',tts:'TTS',nlp:'NLP',b2:'B2',r2:'R2'};
  function tc(s) { return s.split('-').map(w=>UP[w]||w.charAt(0).toUpperCase()+w.slice(1)).join(' '); }

  function mkCard(l) {
    const n = l.serviceName||'unknown';
    const d = document.createElement('div');
    d.className = 'card';

    let tags = '';
    const pr = l.protocol||'';
    const pm = l.pricingModel||'';
    if (pr) tags += `<span class="pill pill-proto">${pr}</span>`;
    if (pm === 'free') tags += `<span class="pill pill-free">Free</span>`;
    else if (pm) tags += `<span class="pill pill-paid">${pm}</span>`;

    d.innerHTML = `<div class="card-ico" style="background:${hc(n)}">${ini(n)}</div><div class="card-body"><div class="card-top"><span class="card-name">${tc(n)}</span></div><div class="card-desc">${l.description||''}</div>${tags?`<div class="card-tags">${tags}</div>`:''}</div>`;
    return d;
  }

  function render() {
    grid.innerHTML = '';
    if (!filtered.length) {
      grid.style.display = 'none';
      emptyState.style.display = 'block';
      moreWrap.style.display = 'none';
      info.textContent = '';
      return;
    }
    emptyState.style.display = 'none';
    grid.style.display = '';
    const items = filtered.slice(0, shown);
    for (const l of items) grid.appendChild(mkCard(l));
    const rem = filtered.length - shown;
    moreWrap.style.display = rem > 0 ? 'block' : 'none';
    if (rem > 0) moreCount.textContent = `(${rem})`;
    const filt = searchInput.value || protocolFilter.value || pricingFilter.value || alphaActive;
    info.textContent = filt
      ? `${Math.min(shown,filtered.length)} of ${filtered.length} results`
      : `${Math.min(shown,filtered.length)} of ${all.length} services`;
  }

  function filter() {
    const q = searchInput.value.toLowerCase().trim();
    const pr = protocolFilter.value.toLowerCase();
    const pm = pricingFilter.value.toLowerCase();
    filtered = all;
    if (alphaActive) filtered = filtered.filter(l=>(l.serviceName||'')[0]?.toLowerCase()===alphaActive);
    if (q) filtered = filtered.filter(l=>(l.serviceName||'').toLowerCase().includes(q)||(l.description||'').toLowerCase().includes(q)||(l.capabilities||'').toLowerCase().includes(q));
    if (pr) filtered = filtered.filter(l=>(l.protocol||'').toLowerCase()===pr);
    if (pm) filtered = filtered.filter(l=>(l.pricingModel||'').toLowerCase()===pm);
    shown = PER_PAGE;
    render();
  }

  function buildAlpha() {
    const has = new Set(all.map(l=>(l.serviceName||'')[0]?.toLowerCase()).filter(Boolean));
    alphaNav.innerHTML = '';
    const ab = document.createElement('button');
    ab.className = 'alpha-letter active'; ab.textContent = 'All';
    ab.onclick = () => { alphaActive=''; setA(ab); filter(); };
    alphaNav.appendChild(ab);
    for (let i=0;i<26;i++) {
      const ch = String.fromCharCode(97+i);
      const b = document.createElement('button');
      b.className = 'alpha-letter' + (has.has(ch)?'':' off');
      b.textContent = ch.toUpperCase();
      if (has.has(ch)) b.onclick = () => { alphaActive=ch; setA(b); filter(); };
      alphaNav.appendChild(b);
    }
  }

  function setA(btn) { alphaNav.querySelectorAll('.alpha-letter').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); }

  searchInput.addEventListener('input', () => { alphaActive=''; setA(alphaNav.querySelector('.alpha-letter')); filter(); });
  protocolFilter.addEventListener('change', filter);
  pricingFilter.addEventListener('change', filter);
  moreBtn.addEventListener('click', () => { shown += PER_PAGE; render(); });
  clearBtn.addEventListener('click', () => {
    searchInput.value=''; protocolFilter.value=''; pricingFilter.value='';
    alphaActive=''; setA(alphaNav.querySelector('.alpha-letter')); filter();
  });

  (async () => {
    try {
      const r = await fetch('https://api.agentdoor.ai/directory');
      const d = await r.json();
      all = d.listings || [];
      totalCount.textContent = all.length.toLocaleString();
      loading.style.display = 'none';
      buildAlpha();
      filtered = all;
      shown = PER_PAGE;
      render();
    } catch {
      loading.innerHTML = '<p style="color:#a3a3a3;font-size:14px">Failed to load directory.</p>';
    }
  })();
</script>
